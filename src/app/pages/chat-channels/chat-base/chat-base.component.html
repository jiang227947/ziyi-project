<div class="container">
  <!--左侧导航-->
  <div class="sidebar isHidden" [ngClass]="{'sidebar-collapsed':isCollapsed}" (click)="publicClose()">
    <!--用户列-->
    <ol class="scrollerInner" aria-label="用户" role="list" tabindex="0">
      <!--每一个在线用户-->
      <li class="onlineUserList" aria-setsize="-1" *ngFor="let item of onlineUserList;index as idx">
        <div class="user-item" (contextmenu)="contextMenu($event, menu)">
          <!--头像-->
          <ng-container *ngIf="!item.avatar;else avatar">
            <nz-avatar
              [nzGap]="1"
              [ngStyle]="{ 'background-color': '#ffbf00' }"
              [nzText]="item.userName"
              nzSize="large"
              style="vertical-align: middle;"
              class="user-avatar"
            ></nz-avatar>
          </ng-container>
          <ng-template #avatar>
            <img [src]="item.avatar | avatarConversion" alt="头像" class="user-avatar">
          </ng-template>
          <!--名称-->
          <p class="user-title">
            {{item.userName}}
          </p>
          <!--备注-->
          <p class="user-remarks">
            {{item.remarks}}
          </p>
        </div>
        <nz-dropdown-menu #menu="nzDropdownMenu">
          <ul nz-menu>
            <li nz-menu-item (click)="mention(item)">@提及</li>
          </ul>
        </nz-dropdown-menu>
      </li>
    </ol>
  </div>
  <!--中间和右侧房间信息-->
  <div class="chat">
    <div class="content">
      <!--置顶-->
      <div class="top-info">
        <div class="info-txt">
          欢迎来到公共聊天频道！
        </div>
        <div class="operation-group">
          <span class="operation hidden-user-list" title="在线用户" nz-icon nzType="team" nzTheme="outline"
                (click)="hiddenOnlineUser()"></span>
          <span class="operation quit" title="退出" nz-icon nzType="poweroff" nzTheme="outline"
                (click)="quit()"></span>
        </div>
      </div>
      <!--主体框-->
      <div class="messagesWrapper" (click)="publicClose()">
        <div #scrollerBase class="scrollerBase">
          <!--消息列-->
          <ol class="scrollerInner" aria-label="消息" role="list" tabindex="0">
            <!--每一条消息-->
            <li class="messageListItem" aria-setsize="-1" *ngFor="let item of messagesList;index as idx">
              <ng-container [ngSwitch]="item.type">
                <!--一般消息-->
                <ng-container *ngSwitchCase="chatMessagesType.general">
                  <div class="message" role="article" tabindex="-1" aria-setsize="-1" aria-roledescription="消息"
                       aria-labelledby="message-username">
                    <div class="contents">
                      <!--头像-->
                      <ng-container *ngIf="!item.author.avatar;else _avatar">
                        <nz-avatar
                          [nzGap]="1"
                          [ngStyle]="{ 'background-color': '#ffbf00' }"
                          [nzText]="item.author.username"
                          nzSize="large"
                          style="vertical-align: middle;"
                          class="user-avatar"
                        ></nz-avatar>
                      </ng-container>
                      <ng-template #_avatar>
                        <img [src]="item.author.avatar | avatarConversion" aria-hidden="true" class="user-avatar"
                             alt="头像">
                      </ng-template>
                      <!--消息头-->
                      <h3 class="header" aria-labelledby="message-username">
                    <span class="headerText">
                      <!--用户名-->
                      <span class="username" aria-expanded="false" role="button"
                            tabindex="0">{{item.author.username}}</span>
                      <span class="timestamp" role="button" tabindex="0">
                        <!--时间-->
                        <time aria-label="{{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | dateConversion}}"
                              datetime="{{item.timestamp}}">
                          {{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | dateConversion}}
                        </time>
                      </span>
                    </span>
                      </h3>
                      <!--文字消息-->
                      <div class="markupMessage">{{item.content}}</div>
                    </div>
                  </div>
                </ng-container>
                <!--连续发言-->
                <ng-container *ngSwitchCase="chatMessagesType.continuous">
                  <div class="message continuous">
                    <div class="timestamp timeHidden">
                      <time aria-label="{{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | timeConversion}}"
                            datetime="{{item.timestamp}}">
                        {{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | timeConversion}}
                      </time>
                    </div>
                    <!--文字消息-->
                    <div class="markupMessage">{{item.content}}</div>
                  </div>
                </ng-container>
                <!--系统消息-->
                <ng-container *ngSwitchCase="chatMessagesType.system">
                  <div class="system">
                    <div class="timestamp timeHidden">
                      <time aria-label="{{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | timeConversion}}"
                            datetime="{{item.timestamp}}">
                        {{item.timestamp | date:'yyyy/MM/dd HH:mm:ss' | timeConversion}}
                      </time>
                    </div>
                    <ng-container *ngIf="item.systemStates === 'userJoin'">
                      <span class="user-join">{{item.userName}}</span>
                      <span>进入频道</span>
                    </ng-container>
                    <ng-container *ngIf="item.systemStates === 'userlLeft'">
                      <span class="user-join">{{item.userName}}</span>
                      <span>离开频道</span>
                    </ng-container>
                  </div>
                </ng-container>
              </ng-container>
            </li>
          </ol>
        </div>
      </div>
      <!--输入框-->
      <div class="channelTextArea">
        <div class="formArea">
          <!--附加-->
          <div class="additional">
            <!--表情-->
            <span class="icon" title="表情" (click)="morOperate.emoji = !morOperate.emoji">
              <svg class="aliicon" aria-hidden="true">
                <use xlink:href="#icon-emojifill"></use>
              </svg>
            </span>
            <!--上传-->
            <span class="icon" title="上传" (click)="morOperate.fileUpload = !morOperate.fileUpload">
              <svg class="aliicon" aria-hidden="true">
                <use xlink:href="#icon-jiahao2fill"></use>
              </svg>
            </span>
          </div>
          <!--文字-->
          <div class="textArea" (click)="publicClose()">
            <!--placeholder-->
            <div class="placeholder" aria-hidden="true" *ngIf="textValue === ''">开始聊天</div>
            <!--输入框-->
            <div #textBox role="textbox" class="markup" spellcheck="true" aria-haspopup="listbox" aria-invalid="false"
                 aria-autocomplete="list" contenteditable="true"
                 (keydown)="textBoxKeydown($event)"
                 (paste)="paste($event)"
                 (input)="textBoxChange($event)">
            </div>
          </div>
          <!--发送按钮-->
          <div class="buttonArea">
            <button type="submit" nz-button nzType="primary" class="send-button" title="send" (click)="send()">
              <span nz-icon nzType="send" nzTheme="outline"></span>
            </button>
          </div>
        </div>
      </div>
      <!--表情选择-->
      <div class="emoji-select" [ngClass]="{'emoji-active': morOperate.emoji}">
        <div class="emoji-content" *ngIf="morOperate.emoji">
          <span class="emoji" *ngFor="let item of emojiList;index as idx" (click)="emojiClick(item, idx)">
            {{item}}
          </span>
        </div>
      </div>
      <!--附件上传-->
      <div class="file-upload" [ngClass]="{'file-upload-active': morOperate.fileUpload}"></div>
    </div>
  </div>
</div>
